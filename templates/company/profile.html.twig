{% extends 'base_homepage.html.twig' %}

{% block title %}<title>Profil</title>{% endblock %}

{% block body %}
    {# ******************************* NavBar ***************************************** #}
    <link rel="stylesheet" href="{{ asset('css/profile_entreprise.css') }}"/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
          integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
          crossorigin=""/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet-search/2.9.9/leaflet-search.min.css" integrity="sha512-8zuX58lcEgyZdtfTu5Iu9SDfadAirBVoZrJkmuZJ+/s80QZ/YTNVlEqPtE9iHqNXeCgd122pl+inU1Oxn9KXng==" crossorigin="anonymous" />

    <div class="showcase"  style="width:100%;background-image: url({{asset('/images/header_profil_entreprise2.png')}}); height: 100vh;background-position:center ; background-size: cover ; background-repeat: no-repeat ">
        {% include "navbar.html.twig" with { 'role' : "USER" } %}
        <div class="header-content">
            <h3 class="banner-profil-title">Mon compte</h3>
            <div class="div-btn-banner">
                <button onclick="location.href='/profile/entreprise'" class="btn-banner" >
                    <svg xmlns="http://www.w3.org/2000/svg" width="100%" viewBox="0 0 232 70">
                        <defs>
                            <style>
                                .a,.c{fill:none;}.b{fill:#fff;font-size:18px;}.c,.d{stroke:white;stroke-miterlimit:10;stroke-width:1.5px;}.d{fill:none;}
                            </style>
                        </defs>
                        <g transform="translate(-463 -397)">
                            <rect class="a" width="232" height="70" rx="10" transform="translate(463 397)"/>
                            <text class="b" transform="translate(585.996 439)">
                                <tspan x="-23.989" y="0">Profil</tspan>
                            </text>
                            <g transform="translate(-20234.004 4150)">
                                <circle class="c" cx="4.743" cy="4.743" r="4.743" transform="matrix(0.299, -0.954, 0.954, 0.299, 20738.293, -3718.946)"/>
                                <path class="d" d="M225.762,131.932a5.428,5.428,0,0,1,1.132.143c2.4.378,3.967,3.428,3.967,6.69H214.4c0-3.543,1.852-6.834,5.1-6.834Z" transform="translate(20521.611 -3846.652)"/>
                            </g>
                        </g>
                    </svg>
                </button>
                <button onclick="location.href='{{ url('Dashboard') }}'" class="btn-banner" >
                    <svg xmlns="http://www.w3.org/2000/svg" width="100%" viewBox="0 0 232 70">
                        <defs>
                            <style>
                                .a-dash{fill:white;}.b-dash,.d-dash{fill:none;stroke:black;stroke-miterlimit:10;}.b-dash{stroke-width:1.5px;}.c-dash,.e-dash{fill:black;}.d-dash{stroke-width:0.5px;}.e-dash{font-size:18px;}
                            </style>
                        </defs>
                        <g transform="translate(-740 -397)">
                            <rect class="a-dash" width="232" height="70" rx="10" transform="translate(740 397)"/>
                            <g transform="translate(-8 20)"><circle class="b-dash" cx="10.5" cy="10.5" r="10.5" transform="translate(787 401)"/>
                                <line class="b-dash" y2="2.882" transform="translate(797.5 401)"/>
                                <line class="b-dash" x2="2.882" transform="translate(787 411.5)"/>
                                <line class="b-dash" x2="2.882" transform="translate(805.117 411.5)"/>
                                <line class="b-dash" x2="2.038" y2="2.038" transform="translate(790.141 403.882)"/>
                                <line class="b-dash" x2="2.038" y2="2.038" transform="translate(803.07 416.812)"/>
                                <line class="b-dash" y1="2.038" x2="2.038" transform="translate(790.564 417.237)"/>
                                <line class="b-dash" y1="2.038" x2="2.038" transform="translate(803.295 404.506)"/>
                                <circle class="c-dash" cx="1.052" cy="1.052" r="1.052" transform="translate(796.449 410.448)"/>
                                <line class="d-dash" y1="1.422" x2="1.422" transform="translate(797.5 410.078)"/>
                                <rect class="c-dash" width="3.508" height="1.09" transform="translate(795.568 418.975)"/>
                            </g>
                            <text class="e-dash" transform="translate(890 439)">
                                <tspan x="-49.336" y="0">Dashboard</tspan>
                            </text>
                        </g>
                    </svg>
                </button>
                <button onclick="location.href='/parametres/entreprise'" class="btn-banner">
                    <svg xmlns="http://www.w3.org/2000/svg" width="100%" viewBox="0 0 232 70">
                        <defs>
                            <style>
                                .a-param{fill:#fff;}.b-param{font-size:18px;}.c-param{fill:none;stroke:#161615;stroke-miterlimit:10;stroke-width:1.5px;}
                            </style>
                        </defs>
                        <g transform="translate(-1018 -397)">
                            <rect class="a-param" width="232" height="70" rx="10" transform="translate(1018 397)"/>
                            <text class="b-param" transform="translate(1171 439)">
                                <tspan x="-51.821" y="0">Paramètres</tspan>
                            </text>
                            <g transform="translate(453.75 268.502)">
                                <g transform="translate(602.967 152.498)">
                                    <path class="c-param" d="M603.745,167.687a.168.168,0,0,0,.157.116l2.049.028a8.931,8.931,0,0,0,1.887,2.191l-.275,2.029a.169.169,0,0,0,.091.173l2.195,1.106a.168.168,0,0,0,.193-.03l1.467-1.428a8.921,8.921,0,0,0,2.884.213l1.241,1.63a.168.168,0,0,0,.187.058l2.334-.77a.169.169,0,0,0,.116-.158l.028-2.049a8.924,8.924,0,0,0,2.191-1.887l2.029.275a.168.168,0,0,0,.173-.091L623.8,166.9a.168.168,0,0,0-.03-.193l-1.428-1.467a8.919,8.919,0,0,0,.213-2.884l1.63-1.241a.168.168,0,0,0,.058-.186l-.77-2.334a.168.168,0,0,0-.157-.116l-2.049-.028a8.917,8.917,0,0,0-1.887-2.191l.275-2.029a.169.169,0,0,0-.091-.173l-2.195-1.106a.168.168,0,0,0-.193.03l-1.467,1.428a8.92,8.92,0,0,0-2.884-.213l-1.241-1.63a.168.168,0,0,0-.187-.058l-2.334.77a.169.169,0,0,0-.116.158l-.028,2.049a8.923,8.923,0,0,0-2.191,1.887l-2.029-.275a.168.168,0,0,0-.173.091l-1.106,2.195a.168.168,0,0,0,.03.193l1.428,1.467a8.929,8.929,0,0,0-.213,2.884l-1.63,1.241a.168.168,0,0,0-.058.186Z" transform="translate(-602.967 -152.498)"/>
                                </g>
                                <circle class="c-param" cx="6.326" cy="6.326" r="6.326" transform="translate(607.283 156.814)"/>
                            </g>
                        </g>
                    </svg>
                </button>
                <button onclick="location.href='/produits'" class="btn-banner">
                    <svg xmlns="http://www.w3.org/2000/svg" width="100%" viewBox="0 0 232 70">
                        <defs>
                            <style>
                                .a-produits{fill:#fff;}.b-produits{font-size:18px;fill:#161615;}.c-produits{fill:none;stroke:#161615;stroke-miterlimit:10;stroke-width:2.5px;}
                            </style>
                        </defs>
                        <g transform="translate(-1302 -397)">
                            <rect class="a-produits" width="232" height="70" rx="10" transform="translate(1302 397)"/>
                            <text class="b-produits" transform="translate(1437 439)">
                                <tspan x="-63.983" y="0">Produits/Services</tspan>
                            </text>
                            <g transform="translate(598.342 313.836)">
                                <path class="c-produits" d="M761.227,113.287a5.7,5.7,0,1,0-11.364,0" transform="translate(-14.973)"/>
                                <rect class="c-produits" width="15.825" height="14.877" transform="translate(732.659 113.287)"/>
                            </g>
                        </g>
                    </svg>
                </button>

                {# <button  onclick="location.href='/profile/entreprise'" class="showcase__btn-entreprise">Profil</button>
            <button onclick="location.href='{{ url('VisitesParMois',{months:1}) }}'" class="showcase__btn-ville">Dashboard</button>
            <button onclick="location.href='/parametres/entreprise'" class="showcase__btn-ville">Paramètres</button>
            <button onclick="location.href='/produits'" class="showcase__btn-ville">Produits</button>
            <button onclick="location.href='/services'" class="showcase__btn-ville">Services</button>
                #}
            </div>
        </div>

        <div class="banner-profil-description">
            Le Répertoire Vert offre le référencement et l’évaluation de tous les produits et/ou services professionnels verts proposés dans un rayon de 130 km autour de Genève
        </div>
    </div>
    {# ******************************* FinNavBar ***************************************** #}
    </div>
    <div class="green-intro">
        <div class="green-intro-text">
            Bienvenue sur votre page profil entreprise !
            Vous trouverez toutes les informations concernant votre entreprise ainsi que votre vision du développement durable.
            Veillez bien à remplir au maximum les informations vous concernant, cela aidera beaucoup des consommateurs qui souhaitent en apprendre davantage sur vous !
        </div>
    </div>

    <div class="header-entreprise">

        <div class="title-entreprise">
            <div class="container-fiche">
                <span>Fiche entreprise</span>
                <span class="pointe-droite">
                    <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 35 40">
                        <path d="M20,0,40,35H0Z" transform="translate(35) rotate(90)"/>
                    </svg>
                </span>
                <span>{{ company.name }}</span>
            </div>
        </div>
        <div class="favoris-entreprise">
            <div class="container-favoris">
                <div class="add-favoris">Ajouter aux favoris</div>
                <div class="icon-star">
                    <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 30.3 28.817"><defs><style>.a{fill:#618226;}</style></defs><path class="a" d="M142.167,65.828l4.682,9.486,10.469,1.521-7.575,7.384,1.788,10.426-9.363-4.923L132.8,94.645l1.788-10.426-7.575-7.384,10.469-1.521Z" transform="translate(-127.017 -65.828)"/></svg>
                </div>
                <div class="nb-favoris">
                    <span class="total-favoris">{{ company.companyFavCompanies|length }}</span> favoris
                </div>
            </div>
        </div>


    </div>

    <div class="container-profil">
        <div class="entreprise-details">
            <div class="logo-entreprise">
                {% if company.image is null %}
                    <div class="no-logo">Aucun logo sélectionné</div>
                {% else %}
                <img src="{{ asset('css/img/company/' ~company.image) }}">
                {% endif %}

            </div>
            <div class="container-data-entreprise">
                <div class="data-entreprise">{{company.name}}</div>
                <div class="data-entreprise">{{ company.street }}</div>
                <div class="data-entreprise">{{ company.city }}</div>
                <div class="data-entreprise">{{ company.postcode }}</div>
                <div class="data-entreprise">{{ company.email }}</div>
                <div class="data-entreprise">{{company.phone}}</div>
            </div>
        </div>

        <div data-id="{{ company.id }}" data-lat="{{ company.latitude }}" data-long="{{ company.longtitude }}" id="map" class="carte-entreprise">

        </div>
    </div>

    <div class="div-description-vision">
        <div class="container-description-vision">
            <div class="div-description">
                <div class="title-descrption-entreprise">
                    Description de l’entreprise :
                </div>
                <div class="description-entreprise">
                    <div class="description-pointe-droite">
                        <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 35 40">
                            <path d="M20,0,40,35H0Z" transform="translate(35) rotate(90)"/>
                        </svg>
                    </div>
                    <div class="description-text">
                        {{ company.description }}
                    </div>
                </div>
            </div>

            <div class="div-vision">
                <div class="title-vision-entreprise">
                    Vision du développement Durable
                </div>
                <div class="question-vision">
                    Comment résumeriez-vous votre philosophie d’entreprise au sujet du développement durable ?
                </div>
                <div class="vision-entreprise">
                    <div class="vision-pointe-droite">
                        <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 35 40">
                            <path d="M20,0,40,35H0Z" transform="translate(35) rotate(90)"/>
                        </svg>
                    </div>
                    <div class="description-text">
                        {{ company.vision }}
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% for cat in company.categories %}

        {# ON CALCULE LE NOMBRE TOTAL DE SUBCAT POUR CHAQUE CATEGORIES #}
        {% set total_subcat = 0 %}
        {% for subcat in cat.subcategories %}
            {%  set total_subcat = total_subcat + 1 %}
        {% endfor %}
        {% set icon_par_colonne  = (total_subcat/3) %}
        {% set icon_par_colonne = icon_par_colonne|round(0,'ceil') %}

        {# %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% #}


        <div class="div-subcat">
            <div class="container-subcat">
                <div class="cat-principal">
                    <div class="container-icon-cat">
                        <div class="icon-cat">
                            <img  src="{{ asset('images/Icones_Categories/'~cat.name~'/' ~cat.name|basename ~'.png') }}">
                        </div>
                    </div>
                    <div class="cat-name">{{ cat.name }}</div>
                </div>
                <div class="all-subcat">

                        {% for subcat in subcategories %}

                            {% if subcat in cat.subcategories %}

                                <div class="card-subcat subcat-mrgb">
                                    <div class="container-icon-subcat">
                                        <div class="icon-subcat">
                                            <img  src="{{ asset('images/Icones_Categories/'~cat.name~'/Icônes sous-catégories/'~ subcat.name~'.png') }}">
                                        </div>
                                    </div>
                                    <div class="subcat-name">
                                        {{subcat.name}}
                                    </div>
                                </div>
                            {% endif %}
                        {% endfor %}

                </div>

            </div>
        </div>
    {% endfor %}

{# %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% #}


    <div class="div-modif-suppr">
        <a href="{{ url('compagnySettings') }}" class="btn-modifier">Modifier le profil</a>
        <button onclick="document.getElementById('categories').style.display = 'block';" class="btn-modifier">Modifier les catégories</button>
    </div>
    <div id="categories" class="categories">
        <div class="categories-list">

            {% for category in categories %}
                {# {% for cat in company.categories %} #}
                {% if category in company.categories %}
                    <div class="categories-element">
                        <input type="checkbox" id="{{ category.name }}" name="{{ category.name }}" checked>
                        <label for="{{ category.name }}">{{ category.name }}</label>
                    </div>
                {% else %}
                    <div class="categories-element">
                        <input type="checkbox" id="{{ category.name }}" name="{{ category.name }}">
                        <label for="{{ category.name }}">{{ category.name }}</label>
                    </div>
                {% endif %}

                {# {% endfor %} #}
            {% endfor %}
        </div>
        <div class="categories-popup-button">
            <button class="categories-button" onclick='document.getElementById("categories").style.display = "none";'>Valider</button>
        </div>
    </div>
    {# %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% #}

    {#########  PROGRAMMES GAEA 21 ###########}
    <div class="div-programs">
        <div class="container-programs">

            <div class="dash-program-card">
                <img  src="{{ asset('css/img/image_SLP.jpg') }}">
            </div>

            <div class="dash-program-card">
                <img  src="{{ asset('css/img/image_GC.jpg') }}">
            </div>

            <div class="dash-program-card">
                <img  src="{{ asset('css/img/image_GES.jpg') }}">
            </div>

        </div>
    </div>

    {% block javascripts %}

        {# <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
                integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
                crossorigin=""></script>#}
        <script src="https://unpkg.com/leaflet@1.3.0/dist/leaflet.js"></script>
        <script src="{{ asset('js/map_entreprise.js') }}"></script>
        <script>

            // Modification des catégories
            $('.categories-button').click(function () {
                let categories = [];
                $.get('/rest/category', function(dataCategories) {
                    dataCategories.forEach(category => {
                        let checkbox = document.getElementById(category.name)
                        if(checkbox.checked){
                            categories.push(category)
                        }
                    })


                    let objArr = JSON.stringify({
                        "categories": categories,
                    });

                    $.ajax({
                        method: "POST",
                        url: "/redirectModifyCategories/",
                        dataType: "json",
                        data: objArr,

                    }).done(
                        function(response2) {
                            console.log(response2)
                            location.href='/profile/entreprise'
                        }
                    )

                });
            })

        </script>
    {% endblock %}

{% include 'footer.html.twig' %}
{% endblock %}
